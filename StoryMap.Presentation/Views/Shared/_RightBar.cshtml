<div class="col-md-3" style="padding-left: 0px; padding-right: 10px;">
    <div class="rightbar">
        <!-- Characters List -->
        <div class="card mb-3">
            <div class="card-header" data-bs-toggle="collapse" data-bs-target="#charactersCollapse" role="button" aria-expanded="false" aria-controls="charactersCollapse">
                <span class="icon ms-0"> &gt; </span> <strong>Characters</strong>
            </div>
            <div class="collapse" id="charactersCollapse">
                <div class="list-group list-group-flush">
                    <!-- Loop through characters (for testing) -->
                    @for (int i = 1; i <= 5; i++)
                    {
                        <a href="#" class="list-group-item list-group-item-action pe-3" data-bs-toggle="collapse" data-bs-target="#characterCollapse@i" role="button" aria-expanded="false" aria-controls="characterCollapse@i">
                            Character @i <span class="icon ms-auto"> &gt; </span>
                        </a>
                        <div class="collapse" id="characterCollapse@i">
                            <ul class="list-unstyled me-3">
                                <!-- Additional info (optional) -->
                                <li>Details about Character @i</li>
                            </ul>
                        </div>
                    }
                    <!-- Last item is Add Character -->
                    <a href="#" class="list-group-item list-group-item-action pe-3">Add Character</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom Styling for RightBar -->
<style>
    /* Right sidebar styling */
    .rightbar {
        background-color: #e3f2fd; /* Match the navbar background */
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Shadow for floating effect */
        position: fixed; /* Fixed position ensures it stays in place */
        top: 130px; /* Start 130px from the top (just below the navbar) */
        right: 20px; /* 20px from the right margin */
        bottom: 20px; /* Extend it to the bottom of the viewport */
        width: 230px; /* Sidebar width */
        height: calc(100vh - 150px); /* Ensure it takes full height from navbar to bottom */
        z-index: 1050; /* Ensure it stays on top of other elements */
        overflow-y: auto; /* Allow scrolling if content exceeds sidebar height */
    }

    /* Card header and body styles */
    .card-header {
        background-color: #e3f2fd; /* Match the navbar background */
        border-bottom: 2px solid #bbb;
        display: flex;
        align-items: center;
    }

    .card-header .icon {
        font-size: 1.2rem;
        margin-right: auto; /* Move icon to the left */
        transform: rotate(90deg); /* Rotate the icon */
        transition: transform 0.3s ease; /* Animate the icon */
    }

    .card-header.collapsed .icon {
        transform: rotate(0deg); /* Rotate back when collapsed */
    }

    /* List item styling */
    .list-group-item {
        border: none; /* Remove borders for all list items */
        padding-right: 20px; /* Slight indentation */
    }

    .list-group-item-action:hover {
        background-color: #b3e0ff; /* Hover effect */
    }

    /* Nested lists inside items (for images and timeframes) */
    .list-unstyled {
        padding-right: 20px;
    }

    /* Nested list items */
    .list-unstyled li {
        padding-right: 10px; /* Slight nesting */
    }
</style>

<!-- Initialize Bootstrap Collapse -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize all collapses (but do not automatically show)
        var collapseElements = document.querySelectorAll('.collapse');
        collapseElements.forEach(function (el) {
            new bootstrap.Collapse(el, {
                toggle: false // Prevent auto-toggle on page load
            });
        });

        // Add event listener to each toggle trigger
        document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(function (trigger) {
            trigger.addEventListener('click', function (event) {
                // Prevent default action (e.g., jumping to the link)
                event.preventDefault();
                
                // Get the target collapse ID from the clicked element's data-bs-target
                var targetId = event.currentTarget.getAttribute('data-bs-target');
                
                // Find the collapse element to toggle
                var targetCollapse = document.querySelector(targetId);

                // Toggle the specific collapse item
                var collapseInstance = new bootstrap.Collapse(targetCollapse);
                collapseInstance.toggle(); // This method ensures it toggles only that collapse
            });
        });
    });
</script>
